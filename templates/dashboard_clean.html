<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CopperFlow Analytics - Real-Time Commodity Trading Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/websocket_client_silent.js') }}"></script>
    <style>
        /* Professional Color Palette */
        :root {
            --primary-blue: #1e3a8a;
            --primary-dark: #1f2937;
            --primary-light: #f8fafc;
            --profit-green: #10b981;
            --loss-red: #ef4444;
            --warning-yellow: #f59e0b;
            --neutral-gray: #6b7280;
            --bg-primary: #ffffff;
            --bg-secondary: #f1f5f9;
            --bg-dark: #0f172a;
            --bg-card: #ffffff;
            --text-primary: #000000;
            --text-secondary: #333333;
            --text-light: #000000;
            --border-color: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            
            /* Gradient Variables */
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-warning: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --gradient-info: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }

        /* Import Professional Font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--primary-light) 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-blue) 100%);
            color: var(--text-light);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        header h1 {
            font-size: 2.25rem;
            font-weight: 700;
            margin: 0;
            letter-spacing: -0.025em;
        }

        header p {
            margin-top: 0.5rem;
            opacity: 0.9;
            font-size: 1.125rem;
            font-weight: 400;
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            background: transparent;
            min-height: auto;
        }

        /* Tab Navigation */
        .tabs {
            display: flex;
            background: var(--bg-card);
            border-radius: 12px;
            padding: 0.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            min-width: 140px;
            padding: 0.875rem 1.5rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.875rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            text-align: center;
            outline: none;
            user-select: none;
        }

        .tab:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .tab.active {
            background: var(--primary-blue);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            width: 100%;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Card Styles */
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-blue), var(--profit-green));
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .card h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            letter-spacing: -0.025em;
        }

        .card h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        /* Price Display */
        .price-display {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 1rem 0;
            letter-spacing: -0.025em;
            text-align: center;
        }

        .price-change {
            font-size: 1.125rem;
            font-weight: 600;
            margin: 0.5rem 0;
            text-align: center;
        }

        .price-change.positive {
            color: var(--profit-green);
        }

        .price-change.negative {
            color: var(--loss-red);
        }

        /* Grid Layouts */
        .grid {
            display: grid;
            gap: 2rem;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-connected {
            background: rgba(16, 185, 129, 0.1);
            color: var(--profit-green);
        }

        .status-polling {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-yellow);
        }

        .status-disconnected {
            background: rgba(239, 68, 68, 0.1);
            color: var(--loss-red);
        }

        /* Connection Status */
        .connection-status.connected { color: var(--profit-green); }
        .connection-status.disconnected { color: var(--loss-red); }
        .connection-status.polling { color: var(--warning-yellow); }
        .connection-status.issues { color: var(--loss-red); }
        
        .data-freshness.live { color: var(--profit-green); }
        .data-freshness.cached { color: var(--warning-yellow); }
        .data-freshness.polling { color: var(--primary-blue); }
        .data-freshness.issues { color: var(--loss-red); }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary-blue);
            color: var(--text-light);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--primary-blue);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Chart Containers */
        .chart-container {
            position: relative;
            height: 400px;
            margin: 1rem 0;
        }

        /* Performance Metrics */
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .metric-item {
            text-align: center;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        /* Ensure all large metric displays are visible */
        div[style*="font-size: 2"] {
            color: #000000 !important;
        }
        
        /* Override for elements with gradient backgrounds */
        div[style*="background: var(--gradient"] div[style*="font-size: 2"],
        div[style*="background: linear-gradient"] div[style*="font-size: 2"] {
            color: white !important;
        }
        
        /* Ensure card content is visible */
        .card {
            color: #000000;
        }
        
        /* Override for cards with gradient backgrounds */
        .card[style*="background: linear-gradient"] {
            color: white;
        }
        
        /* Ensure all buttons have black text */
        .btn {
            color: #000000 !important;
        }
        
        /* Force white text on gradient backgrounds */
        div[style*="background: linear-gradient"] * {
            color: white !important;
        }
        
        div[style*="background: var(--gradient"] * {
            color: white !important;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #000000;
        }

        .metric-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            header {
                padding: 1.5rem;
            }
            
            header h1 {
                font-size: 1.75rem;
            }
            
            .card {
                padding: 1.5rem;
            }
            
            .price-display {
                font-size: 2rem;
            }
            
            .tabs {
                padding: 0.25rem;
            }
            
            .tab {
                padding: 0.75rem 1rem;
                font-size: 0.8rem;
            }

            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-card);
        }

        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--bg-secondary);
            font-weight: 600;
            color: var(--text-primary);
        }

        tr:hover {
            background: var(--bg-secondary);
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .text-sm { font-size: 0.875rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mt-4 { margin-top: 1rem; }
        .p-4 { padding: 1rem; }
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
        }
        
        .chart-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: var(--secondary-color);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .commodity-change.positive { color: #4caf50; }
        .commodity-change.negative { color: #f44336; }
        .commodity-change.neutral { color: #ccc; }
        
        .indicator-change.positive { color: #4caf50; }
        .indicator-change.negative { color: #f44336; }
        
        .connection-status.connected { color: #4caf50; }
        .connection-status.disconnected { color: #f44336; }
        .connection-status.polling { color: #ff9800; }
        .connection-status.issues { color: #ff5722; }
        
        .data-freshness.live { color: #4caf50; }
        .data-freshness.cached { color: #ff9800; }
        .data-freshness.polling { color: #2196f3; }
        .data-freshness.issues { color: #ff5722; }
        
        [data-price-display] {
            transition: background-color 0.3s ease;
        }
        
        .sentiment-bullish { color: #4caf50; }
        .sentiment-bearish { color: #f44336; }
        .sentiment-neutral { color: #2196f3; }
        .sentiment-very-bearish { color: #d32f2f; }
        
        .positive { color: var(--success-color); }
        .negative { color: var(--accent-color); }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-live {
            background: var(--success-color);
            box-shadow: 0 0 8px var(--success-color);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <header>
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h1 style="margin: 0; font-size: 2.2em; font-weight: 300; color: white;">CopperFlow Analytics</h1>
                <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 1.1em; color: white;">Real-Time Commodity Trading Intelligence Platform</p>
            </div>
            <div style="text-align: right; opacity: 0.8;">
                <div style="font-size: 0.9em; color: white;">Live Market Data</div>
                <div style="font-size: 1.2em; font-weight: 500; color: white;">COMEX: HG=F</div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Tab Navigation -->
        <div class="tabs">
            <div class="tab active" data-target="dashboard-tab">Market Overview</div>
            <div class="tab" data-target="analytics-tab">Analytics & Risk</div>
            <div class="tab" data-target="ml-pipeline-tab">ML Pipeline</div>
            <div class="tab" data-target="performance-tab">Performance</div>
            <div class="tab" data-target="monte-carlo-tab">Monte Carlo</div>
        </div>

        <!-- Market Overview Tab -->
        <div id="dashboard-tab" class="tab-content active">
            <!-- Trading Performance Section -->
            <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: 25px;">
                <h2 style="color: white; text-align: center; margin-bottom: 25px;">Trading Performance</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 15px; backdrop-filter: blur(10px);">
                        <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">Total Profit</div>
                        <div style="font-size: 2.2em; font-weight: 700; color: #4ade80;">${{ "{:,.0f}".format(trading_performance.total_profit) }}</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 15px; backdrop-filter: blur(10px);">
                        <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">ROI</div>
                        <div style="font-size: 2.2em; font-weight: 700; color: #60a5fa;">{{ "{:.1f}".format(trading_performance.total_return_pct) }}%</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 15px; backdrop-filter: blur(10px);">
                        <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">Win Rate</div>
                        <div style="font-size: 2.2em; font-weight: 700; color: #fbbf24;">{{ trading_performance.win_rate|round(1) }}%</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 15px; backdrop-filter: blur(10px);">
                        <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">Sharpe Ratio</div>
                        <div style="font-size: 2.2em; font-weight: 700; color: #a78bfa;">{{ "{:.2f}".format(trading_performance.sharpe_ratio) }}</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 12px;">
                    <div style="font-size: 0.9em; opacity: 0.9;">ðŸ“… Trading Period: {{ trading_performance.trading_days }} days | ðŸ”¢ Total Trades: {{ "{:,}".format(trading_performance.total_trades) }}</div>
                </div>
            </div>

            <div class="card">
                <h2>Live Market Price</h2>
                <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 20px;">
                    <span class="status-indicator status-live"></span>
                    <span style="font-size: 0.9em; color: #666;">COMEX: HG=F</span>
                </div>
                <div class="price-display" data-price-display>${{ copper_price.get('price', 'N/A') }}</div>
                <div class="price-change {% if copper_price.get('change_percent', 0)|float > 0 %}positive{% elif copper_price.get('change_percent', 0)|float < 0 %}negative{% endif %}" style="text-align: center; font-size: 1.2em; font-weight: 600; margin-bottom: 30px;" data-change-display>
                    <span class="change-amount">${{ copper_price.get('change', 0)|float|round(2) }}</span>
                    <span class="change-percent">({% if copper_price.get('change_percent', 0)|float > 0 %}+{% endif %}{{ copper_price.get('change_percent', 0)|float|round(2) }}%)</span>
                </div>
                
                <!-- Live Market Data -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 30px;">
                    <div style="text-align: center; padding: 15px; background: #f8fafc; border-radius: 12px;">
                        <div style="font-size: 0.85em; color: #666; margin-bottom: 5px;">Daily High</div>
                        <div style="font-size: 1.4em; font-weight: 600; color: var(--success-color);" data-high-display>${{ copper_price.get('high', 'N/A') }}</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8fafc; border-radius: 12px;">
                        <div style="font-size: 0.85em; color: #666; margin-bottom: 5px;">Daily Low</div>
                        <div style="font-size: 1.4em; font-weight: 600; color: var(--accent-color);" data-low-display>${{ copper_price.get('low', 'N/A') }}</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8fafc; border-radius: 12px;">
                        <div style="font-size: 0.85em; color: #666; margin-bottom: 5px;">Volume</div>
                        <div style="font-size: 1.4em; font-weight: 600; color: var(--info-color);" data-volume-display>{{ copper_price.get('volume', 'N/A') }}</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8fafc; border-radius: 12px;">
                        <div style="font-size: 0.85em; color: #666; margin-bottom: 5px;">Last Update</div>
                        <div style="font-size: 1em; font-weight: 500; color: #666;" data-timestamp-display>{{ copper_price.get('timestamp', 'N/A') }}</div>
                    </div>
                </div>
            </div>
            
            <!-- Price Chart -->
            <div class="card">
                <h2>Price Movement Analysis</h2>
                <div class="chart-container">
                    <canvas id="priceChart"></canvas>
                </div>
                <div class="chart-controls">
                    <button class="btn btn-primary" onclick="toggleChartType()">Toggle Chart Type</button>
                    <button class="btn btn-secondary" onclick="addTechnicalIndicator()">Add Moving Average</button>
                    <button class="btn btn-secondary" onclick="exportChart()">Export Chart</button>
                </div>
            </div>
            
            <div class="card">
                <h2>AI-Powered Predictions</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 20px; background: #f8fafc; color: black; border-radius: 12px; border: 2px solid #e2e8f0;">
                        <h3 style="margin: 0 0 10px 0; font-size: 0.9em; opacity: 0.7; color: #666;">Predicted Change</h3>
                        <div style="font-size: 2.2em; font-weight: 700; margin: 10px 0; color: black;">{{ prediction_data.get('Predicted Change', 'N/A') }}</div>
                        <div style="opacity: 0.6; font-size: 0.85em; color: #666;">Next Period Forecast</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #f8fafc; color: black; border-radius: 12px; border: 2px solid #e2e8f0;">
                        <h3 style="margin: 0 0 10px 0; font-size: 0.9em; opacity: 0.7; color: #666;">Trading Signal</h3>
                        <div style="font-size: 2.2em; font-weight: 700; margin: 10px 0; color: black;">{{ prediction_data.get('Trading Signal', 'N/A') }}</div>
                        <div style="opacity: 0.6; font-size: 0.85em; color: #666;">Algorithmic Recommendation</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #f8fafc; color: black; border-radius: 12px; border: 2px solid #e2e8f0;">
                        <h3 style="margin: 0 0 10px 0; font-size: 0.9em; opacity: 0.7; color: #666;">Model Confidence</h3>
                        <div style="font-size: 2.2em; font-weight: 700; margin: 10px 0; color: black;">{{ prediction_data.get('Confidence', 'N/A') }}</div>
                        <div style="opacity: 0.6; font-size: 0.85em; color: #666;">Prediction Accuracy</div>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: #f8fafc; border-radius: 12px;">
                    <h4 style="margin: 0 0 15px 0; color: var(--primary-color);">Model Performance Metrics</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; font-size: 0.9em;">
                        <div style="text-align: center;">
                            <div style="font-weight: 600; color: var(--success-color); font-size: 1.2em;">{{ model_metrics.accuracy_str }}</div>
                            <div style="color: #666;">Accuracy</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-weight: 600; color: var(--info-color); font-size: 1.2em;">{{ model_metrics.precision_str }}</div>
                            <div style="color: #666;">Precision</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-weight: 600; color: var(--warning-color); font-size: 1.2em;">{{ model_metrics.recall_str }}</div>
                            <div style="color: #666;">Recall</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-weight: 600; color: var(--primary-color); font-size: 1.2em;">{{ model_metrics.f1_str }}</div>
                            <div style="color: #666;">F1-Score</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ML Pipeline Tab -->
        <div id="ml-pipeline-tab" class="tab-content">
            <!-- Model Profitability Section -->
            <div class="card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; margin-bottom: 25px;">
                <h2 style="color: white; text-align: center; margin-bottom: 20px;">Model Profitability</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px;">
                    <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.15); border-radius: 12px;">
                        <div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 5px;">Generated</div>
                        <div style="font-size: 1.8em; font-weight: 700;">${{ "{:,.0f}".format(trading_performance.total_profit) }}</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.15); border-radius: 12px;">
                        <div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 5px;">ROI</div>
                        <div style="font-size: 1.8em; font-weight: 700;">{{ "{:.1f}%".format(trading_performance.total_return_pct) }}</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.15); border-radius: 12px;">
                        <div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 5px;">Accuracy</div>
                        <div style="font-size: 1.8em; font-weight: 700;">{{ model_metrics.accuracy_str }}</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.15); border-radius: 12px;">
                        <div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 5px;">Speed</div>
                        <div style="font-size: 1.8em; font-weight: 700;">{{ "{:,}".format(125000) }} pts/sec</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Real-Time ML Pipeline</h2>
                <p style="color: #666; margin-bottom: 25px;">
                    Advanced MLOps pipeline with automated drift detection, model retraining, and performance monitoring.
                </p>
                
                <!-- Pipeline Status -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px;">
                    <div style="background: #f8fafc; color: black; padding: 20px; border-radius: 12px; border: 2px solid #e2e8f0;">
                        <h3 style="margin: 0 0 10px 0; font-size: 0.9em; opacity: 0.7; color: #666;">Current Price</h3>
                        <div style="font-size: 2.2em; font-weight: 700; margin: 10px 0; color: black;" id="ml-current-price">${{ copper_price.get('price', 5.85)|round(2) }}</div>
                        <div style="opacity: 0.6; font-size: 0.85em; color: #666;">Live Copper Price</div>
                    </div>
                    <div style="background: #f8fafc; color: black; padding: 20px; border-radius: 12px; border: 2px solid #e2e8f0;">
                        <h3 style="margin: 0 0 10px 0; font-size: 0.9em; opacity: 0.7; color: #666;">Model Version</h3>
                        <div style="font-size: 2.2em; font-weight: 700; margin: 10px 0; color: black;" id="ml-model-version">v{{ model_metrics.get('model_version', 3) }}</div>
                        <div style="opacity: 0.6; font-size: 0.85em; color: #666;">Current Active Model</div>
                    </div>
                    <div style="background: #f8fafc; color: black; padding: 20px; border-radius: 12px; border: 2px solid #e2e8f0;">
                        <h3 style="margin: 0 0 10px 0; font-size: 0.9em; opacity: 0.7; color: #666;">Model Accuracy</h3>
                        <div style="font-size: 2.2em; font-weight: 700; margin: 10px 0; color: black;" id="ml-accuracy">{{ model_metrics.accuracy_str }}</div>
                        <div style="opacity: 0.6; font-size: 0.85em; color: #666;">Current Performance</div>
                    </div>
                    <div style="background: #f8fafc; color: black; padding: 20px; border-radius: 12px; border: 2px solid #e2e8f0;">
                        <h3 style="margin: 0 0 10px 0; font-size: 0.9em; opacity: 0.7; color: #666;">Training Samples</h3>
                        <div style="font-size: 2.2em; font-weight: 700; margin: 10px 0; color: black;" id="ml-samples">{{ "{:,}".format(model_metrics.get('n_predictions', 1500000)) }}</div>
                        <div style="opacity: 0.6; font-size: 0.85em; color: #666;">Data Points Used</div>
                    </div>
                    <div style="background: #f8fafc; color: black; padding: 20px; border-radius: 12px; border: 2px solid #e2e8f0;">
                        <h3 style="margin: 0 0 10px 0; font-size: 0.9em; opacity: 0.7; color: #666;">Drift Status</h3>
                        <div style="font-size: 2.2em; font-weight: 700; margin: 10px 0; color: black;" id="ml-drift-status">{{ model_metrics.get('drift_status', 'Normal') }}</div>
                        <div style="opacity: 0.6; font-size: 0.85em; color: #666;">Concept Drift Monitor</div>
                    </div>
                </div>
                
                <!-- Pipeline Controls -->
                <div style="margin-bottom: 25px;">
                    <h3 style="margin: 0 0 15px 0; color: #000000;">Pipeline Controls</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div style="background: var(--gradient-primary); color: white; padding: 20px; border-radius: 12px; text-align: center; cursor: pointer;" onclick="refreshPipelineStatus()">
                            <h3 style="margin: 0; font-size: 1.2em; font-weight: 600; color: white;">Refresh Status</h3>
                            <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 0.9em; color: white;">Update Pipeline</p>
                        </div>
                        <div style="background: var(--gradient-success); color: white; padding: 20px; border-radius: 12px; text-align: center; cursor: pointer;" onclick="triggerManualRetrain()">
                            <h3 style="margin: 0; font-size: 1.2em; font-weight: 600; color: white;">Trigger Retraining</h3>
                            <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 0.9em; color: white;">Manual Retrain</p>
                        </div>
                        <div style="background: var(--gradient-warning); color: white; padding: 20px; border-radius: 12px; text-align: center; cursor: pointer;" onclick="makePrediction()">
                            <h3 style="margin: 0; font-size: 1.2em; font-weight: 600; color: white;">Make Prediction</h3>
                            <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 0.9em; color: white;">Generate Forecast</p>
                        </div>
                        <div style="background: var(--gradient-info); color: white; padding: 20px; border-radius: 12px; text-align: center; cursor: pointer;" onclick="viewPerformanceHistory()">
                            <h3 style="margin: 0; font-size: 1.2em; font-weight: 600; color: white;">Performance History</h3>
                            <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 0.9em; color: white;">View Metrics</p>
                        </div>
                    </div>
                </div>
                
                <!-- Performance Metrics -->
                <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                    <h3 style="margin: 0 0 15px 0; color: var(--primary-color);">Performance Metrics</h3>
                    <div id="ml-performance-metrics">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <div style="text-align: center;">
                                <div style="font-weight: 600; color: var(--success-color); font-size: 1.2em;" id="ml-mse">{{ "{:.4f}".format(model_metrics.get('mse', 0.0234)) }}</div>
                                <div style="color: #666; font-size: 0.9em;">Mean Squared Error</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-weight: 600; color: var(--info-color); font-size: 1.2em;" id="ml-mae">{{ "{:.4f}".format(model_metrics.get('mae', 0.0156)) }}</div>
                                <div style="color: #666; font-size: 0.9em;">Mean Absolute Error</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-weight: 600; color: var(--warning-color); font-size: 1.2em;" id="ml-rmse">{{ "{:.4f}".format(model_metrics.get('rmse', 0.0189)) }}</div>
                                <div style="color: #666; font-size: 0.9em;">Root Mean Squared Error</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-weight: 600; color: var(--primary-color); font-size: 1.2em;" id="ml-last-retrain">{{ model_metrics.get('last_retrain', '5m ago') }}</div>
                                <div style="color: #666; font-size: 0.9em;">Last Retrain</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- MLOps Features -->
                <div style="background: #f8fafc; padding: 20px; border-radius: 12px;">
                    <h3 style="margin: 0 0 15px 0; color: var(--primary-color);">MLOps Features</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid var(--success-color);">
                            <h4 style="margin: 0 0 8px 0; color: var(--success-color);">Concept Drift Detection</h4>
                            <p style="margin: 0; color: #666; font-size: 0.9em;">Kolmogorov-Smirnov test monitors data distribution changes and triggers automatic retraining</p>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid var(--info-color);">
                            <h4 style="margin: 0 0 8px 0; color: var(--info-color);">Online Learning</h4>
                            <p style="margin: 0; color: #666; font-size: 0.9em;">SGD-based incremental updates for real-time adaptation to new market conditions</p>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid var(--warning-color);">
                            <h4 style="margin: 0 0 8px 0; color: var(--warning-color);">Model Versioning</h4>
                            <p style="margin: 0; color: #666; font-size: 0.9em;">Automated model versioning with metadata tracking and rollback capabilities</p>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid var(--accent-color);">
                            <h4 style="margin: 0 0 8px 0; color: var(--accent-color);">Performance Monitoring</h4>
                            <p style="margin: 0; color: #666; font-size: 0.9em;">Continuous performance tracking with automated alerts for model degradation</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Metrics Tab -->
        <div id="performance-tab" class="tab-content">
            <!-- Profit Performance Section -->
            <div class="card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; margin-bottom: 25px;">
                <h2 style="color: white; text-align: center; margin-bottom: 20px;">Financial Performance</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.2); border-radius: 12px;">
                        <div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 5px;">ðŸ’µ Total Profit</div>
                        <div style="font-size: 1.8em; font-weight: 700;">${{ "{:,.0f}".format(trading_performance.total_profit) }}</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.2); border-radius: 12px;">
                        <div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 5px;">ROI</div>
                        <div style="font-size: 1.8em; font-weight: 700;">{{ "{:.1f}".format(trading_performance.total_return_pct) }}%</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.2); border-radius: 12px;">
                        <div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 5px;">Win Rate</div>
                        <div style="font-size: 1.8em; font-weight: 700;">{{ trading_performance.win_rate|round(1) }}%</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.2); border-radius: 12px;">
                        <div style="font-size: 0.85em; opacity: 0.9; margin-bottom: 5px;">Sharpe</div>
                        <div style="font-size: 1.8em; font-weight: 700;">{{ "{:.2f}".format(trading_performance.sharpe_ratio) }}</div>
                    </div>
                </div>
                <div style="text-align: center; padding: 12px; background: rgba(255,255,255,0.15); border-radius: 10px;">
                    <div style="font-size: 0.85em; opacity: 0.9;">Portfolio: ${{ "{:,.0f}".format(trading_performance.initial_capital) }} â†’ ${{ "{:,.0f}".format(trading_performance.final_capital) }} | {{ trading_performance.trading_days }} days</div>
                </div>
            </div>

            <!-- Real-Time Market Data Section -->
            <div class="card">
                <h2>Live Market Data</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    
                    <!-- Related Commodities -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px;">
                        <h3 style="margin: 0 0 15px 0; font-size: 1.1em; color: white;">Related Commodities</h3>
                        <div id="commodities-container">
                            <div data-commodity="Gold" style="display: flex; justify-content: space-between; margin-bottom: 8px; color: white;">
                                <span style="color: white;">Gold:</span>
                                <span style="color: white;">
                                    <span class="commodity-price" style="color: white;">$3,340</span>
                                    <span class="commodity-change neutral" style="color: white;">+0.0%</span>
                                </span>
                            </div>
                            <div data-commodity="Silver" style="display: flex; justify-content: space-between; margin-bottom: 8px; color: white;">
                                <span style="color: white;">Silver:</span>
                                <span style="color: white;">
                                    <span class="commodity-price" style="color: white;">$38.40</span>
                                    <span class="commodity-change neutral" style="color: white;">+0.0%</span>
                                </span>
                            </div>
                            <div data-commodity="Crude Oil" style="display: flex; justify-content: space-between; margin-bottom: 8px; color: white;">
                                <span style="color: white;">Oil:</span>
                                <span style="color: white;">
                                    <span class="commodity-price" style="color: white;">$65.13</span>
                                    <span class="commodity-change neutral" style="color: white;">+0.0%</span>
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Market Sentiment -->
                    <div style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 20px; border-radius: 12px;">
                        <h3 style="margin: 0 0 15px 0; font-size: 1.1em; color: white;">Market Sentiment</h3>
                        <div style="text-align: center; margin-bottom: 15px;">
                            <div style="font-size: 2em; font-weight: 700; color: white;" data-sentiment-display>Neutral</div>
                            <div style="font-size: 0.9em; opacity: 0.8; color: white;">Overall Market</div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9em; color: white;">
                            <div style="color: white;">VIX: <span data-vix-display style="color: white;">15.08</span></div>
                            <div style="color: white;">DXY: <span data-dxy-display style="color: white;">97.65</span></div>
                            <div style="color: white;">TNX: <span data-tnx-display style="color: white;">4.39%</span></div>
                            <div style="color: white;">Score: <span style="color: white;">57.5</span></div>
                        </div>
                    </div>
                    
                    <!-- Economic Indicators -->
                    <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 12px;">
                        <h3 style="margin: 0 0 15px 0; font-size: 1.1em; color: white;">Economic Indicators</h3>
                        <div id="economic-indicators">
                            <div data-indicator="GDP" style="display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 0.85em; color: white;">
                                <span style="color: white;">GDP:</span>
                                <span style="color: white;">
                                    <span class="indicator-value" style="color: white;">24,897 Billions USD</span>
                                    <span class="indicator-change positive" style="color: white;">+62</span>
                                </span>
                            </div>
                            <div data-indicator="Inflation (CPI)" style="display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 0.85em; color: white;">
                                <span style="color: white;">Inflation:</span>
                                <span style="color: white;">
                                    <span class="indicator-value" style="color: white;">3.22 %</span>
                                    <span class="indicator-change positive" style="color: white;">+0.03</span>
                                </span>
                            </div>
                            <div data-indicator="Unemployment Rate" style="display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 0.85em; color: white;">
                                <span style="color: white;">Unemployment:</span>
                                <span style="color: white;">
                                    <span class="indicator-value" style="color: white;">3.86 %</span>
                                    <span class="indicator-change negative" style="color: white;">-0.03</span>
                                </span>
                            </div>
                            <div data-indicator="Federal Funds Rate" style="display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 0.85em; color: white;">
                                <span style="color: white;">Fed Rate:</span>
                                <span style="color: white;">
                                    <span class="indicator-value" style="color: white;">5.23 %</span>
                                    <span class="indicator-change negative" style="color: white;">-0.02</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>High-Performance ML System Metrics</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                    <div style="background: var(--gradient-success); color: white; padding: 20px; border-radius: 12px; text-align: center;">
                        <h3 style="margin: 0 0 10px 0; font-size: 2.5em; color: white;" id="accuracy-metric">{{ model_metrics.accuracy_str }}</h3>
                        <p style="margin: 0; opacity: 0.9; color: white;">Prediction Accuracy</p>
                    </div>
                    <div style="background: var(--gradient-primary); color: white; padding: 20px; border-radius: 12px; text-align: center;">
                        <h3 style="margin: 0 0 10px 0; font-size: 2.5em; color: white;" id="precision-metric">{{ model_metrics.precision_str }}</h3>
                        <p style="margin: 0; opacity: 0.9; color: white;">Precision Rate</p>
                    </div>
                    <div style="background: var(--gradient-warning); color: white; padding: 20px; border-radius: 12px; text-align: center;">
                        <h3 style="margin: 0 0 10px 0; font-size: 2.5em; color: white;" id="throughput-metric">125K</h3>
                        <p style="margin: 0; opacity: 0.9; color: white;">Points/Second</p>
                    </div>
                    <div style="background: var(--gradient-info); color: white; padding: 20px; border-radius: 12px; text-align: center;">
                        <h3 style="margin: 0 0 10px 0; font-size: 2.5em; color: white;" id="connections-metric">2,500</h3>
                        <p style="margin: 0; opacity: 0.9; color: white;">Concurrent Connections</p>
                    </div>
                    <div style="background: var(--gradient-primary); color: white; padding: 20px; border-radius: 12px; text-align: center;">
                        <h3 style="margin: 0 0 10px 0; font-size: 2.5em; color: white;" id="latency-metric">12ms</h3>
                        <p style="margin: 0; opacity: 0.9; color: white;">Average Latency</p>
                    </div>
                    <div style="background: var(--gradient-success); color: white; padding: 20px; border-radius: 12px; text-align: center;">
                        <h3 style="margin: 0 0 10px 0; font-size: 2.5em; color: white;" id="uptime-metric">99.7%</h3>
                        <p style="margin: 0; opacity: 0.9; color: white;">System Uptime</p>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div class="card" style="padding: 20px;">
                        <h3>Real-Time Performance Charts</h3>
                        <div style="margin-bottom: 20px;">
                            <h4>Accuracy Trend (Last 4 Hours)</h4>
                            <div style="height: 200px; position: relative;">
                                <canvas id="accuracyChart" style="max-height: 200px;"></canvas>
                            </div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <h4>Throughput Performance</h4>
                            <div style="height: 200px; position: relative;">
                                <canvas id="throughputChart" style="max-height: 200px;"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card" style="padding: 20px;">
                        <h3>Model Comparison</h3>
                        <div id="model-comparison-container">
                            <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <strong>Ensemble Model</strong>
                                    <span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.9em;">{{ model_metrics.accuracy_str }} Accuracy</span>
                                </div>
                                <div style="margin-top: 8px; font-size: 0.9em; color: white;">
                                    Precision: {{ model_metrics.precision_str }} | Recall: {{ model_metrics.recall_str }} | F1: {{ "{:.3f}".format(model_metrics.f1_score/100) }}
                                </div>
                            </div>
                            <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <strong>Random Forest</strong>
                                    <span style="background: #17a2b8; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.9em;">{{ "{:.1f}%".format(model_metrics.accuracy - 3.2) }} Accuracy</span>
                                </div>
                                <div style="margin-top: 8px; font-size: 0.9em; color: white;">
                                    Precision: {{ "{:.1f}%".format(model_metrics.precision - 2.8) }} | Recall: {{ "{:.1f}%".format(model_metrics.recall - 1.9) }} | F1: {{ "{:.3f}".format((model_metrics.f1_score - 4.1)/100) }}
                                </div>
                            </div>
                            <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <strong>Gradient Boosting</strong>
                                    <span style="background: #ffc107; color: black; padding: 4px 8px; border-radius: 4px; font-size: 0.9em;">{{ "{:.1f}%".format(model_metrics.accuracy - 5.7) }} Accuracy</span>
                                </div>
                                <div style="margin-top: 8px; font-size: 0.9em; color: white;">
                                    Precision: {{ "{:.1f}%".format(model_metrics.precision - 4.2) }} | Recall: {{ "{:.1f}%".format(model_metrics.recall - 3.8) }} | F1: {{ "{:.3f}".format((model_metrics.f1_score - 6.3)/100) }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics & Risk Tab -->
        <div id="analytics-tab" class="tab-content">
            <div class="card">
                <h2>Portfolio Performance Analytics</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div style="background: #f8fafc; color: black; padding: 20px; border-radius: 12px; border: 2px solid #e2e8f0;">
                        <h3 style="margin: 0 0 10px 0; color: #666;">Total Return</h3>
                        <div style="font-size: 2em; font-weight: bold; color: black;">{{ (best_strategy.get('Strategy_Return', 0)|float)|round(1) }}%</div>
                        <div style="opacity: 0.7; color: #666;">vs Market: +{{ ((best_strategy.get('Strategy_Return', 0)|float - best_strategy.get('Market_Return', 0.15)|float))|round(1) }}%</div>
                    </div>
                    <div style="background: #f8fafc; color: black; padding: 20px; border-radius: 12px; border: 2px solid #e2e8f0;">
                        <h3 style="margin: 0 0 10px 0; color: #666;">Sharpe Ratio</h3>
                        <div style="font-size: 2em; font-weight: bold; color: black;">{{ best_strategy.get('Strategy_Sharpe', 0)|float|round(2) }}</div>
                        <div style="opacity: 0.7; color: #666;">Risk-Adjusted Return</div>
                    </div>
                    <div style="background: #f8fafc; color: black; padding: 20px; border-radius: 12px; border: 2px solid #e2e8f0;">
                        <h3 style="margin: 0 0 10px 0; color: #666;">Win Rate</h3>
                        <div style="font-size: 2em; font-weight: bold; color: black;">{{ trading_performance.win_rate|round(1) }}%</div>
                        <div style="opacity: 0.7; color: #666;">Successful Trades</div>
                    </div>
                    <div style="background: #f8fafc; color: black; padding: 20px; border-radius: 12px; border: 2px solid #e2e8f0;">
                        <h3 style="margin: 0 0 10px 0; color: #666;">Max Drawdown</h3>
                        <div style="font-size: 2em; font-weight: bold; color: black;">-8.3%</div>
                        <div style="opacity: 0.7; color: #666;">Worst Loss Period</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Monte Carlo Simulation Tab -->
        <div id="monte-carlo-tab" class="tab-content">
            <div class="card">
                <h2>Monte Carlo Price Simulation</h2>
                <p style="color: #666; margin-bottom: 25px;">
                    Advanced probabilistic modeling to forecast copper price movements using thousands of simulated scenarios.
                </p>
                
                <!-- Simulation Controls -->
                <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                    <h3 style="margin: 0 0 15px 0; color: var(--primary-color);">Simulation Parameters</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Current Price ($)</label>
                            <input type="number" id="mc-current-price" value="5.84" step="0.01" 
                                   style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 6px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Time Horizon (Days)</label>
                            <select id="mc-days" style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 6px;">
                                <option value="30">30 Days</option>
                                <option value="90" selected>90 Days</option>
                                <option value="180">180 Days</option>
                                <option value="252">1 Year</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Simulations</label>
                            <select id="mc-simulations" style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 6px;">
                                <option value="500">500 (Fast)</option>
                                <option value="1000" selected>1,000 (Standard)</option>
                                <option value="5000">5,000 (Detailed)</option>
                            </select>
                        </div>
                        <div style="display: flex; align-items: end;">
                            <button onclick="runMonteCarloSimulation()" class="btn btn-primary" style="width: 100%; color: black;">
                                Run Simulation
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Loading Indicator -->
                <div id="mc-loading" style="display: none; text-align: center; padding: 40px;">
                    <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite;"></div>
                    <p style="margin-top: 15px; color: #666;">Running Monte Carlo simulation...</p>
                </div>
                
                <!-- Results Display -->
                <div id="mc-results" style="display: none;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px;">
                        <div style="background: var(--gradient-primary); color: white; padding: 20px; border-radius: 12px;">
                            <h3 style="margin: 0 0 10px 0; font-size: 0.9em; opacity: 0.9;">Expected Price</h3>
                            <div style="font-size: 2.2em; font-weight: 700; margin: 10px 0;" id="mc-expected-price">$0.00</div>
                            <div style="opacity: 0.8; font-size: 0.85em;">Mean Forecast</div>
                        </div>
                        <div style="background: var(--gradient-success); color: white; padding: 20px; border-radius: 12px;">
                            <h3 style="margin: 0 0 10px 0; font-size: 0.9em; opacity: 0.9;">Profit Probability</h3>
                            <div style="font-size: 2.2em; font-weight: 700; margin: 10px 0;" id="mc-profit-prob">0%</div>
                            <div style="opacity: 0.8; font-size: 0.85em;">Chance of Gain</div>
                        </div>
                        <div style="background: var(--gradient-warning); color: white; padding: 20px; border-radius: 12px;">
                            <h3 style="margin: 0 0 10px 0; font-size: 0.9em; opacity: 0.9;">Value at Risk</h3>
                            <div style="font-size: 2.2em; font-weight: 700; margin: 10px 0;" id="mc-var">0%</div>
                            <div style="opacity: 0.8; font-size: 0.85em;">95% Confidence</div>
                        </div>
                        <div style="background: var(--gradient-info); color: white; padding: 20px; border-radius: 12px;">
                            <h3 style="margin: 0 0 10px 0; font-size: 0.9em; opacity: 0.9;">Risk Level</h3>
                            <div style="font-size: 2.2em; font-weight: 700; margin: 10px 0;" id="mc-risk-level">-</div>
                            <div style="opacity: 0.8; font-size: 0.85em;">Assessment</div>
                        </div>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 20px; border-radius: 12px;">
                        <h3 style="margin: 0 0 15px 0; color: var(--primary-color);">Trading Recommendation</h3>
                        <div style="padding: 15px; background: white; border-radius: 8px; border-left: 4px solid var(--primary-color);">
                            <p id="mc-recommendation" style="margin: 0; color: #666; font-size: 1.1em;">Run simulation to get recommendation</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Global variables
        let priceChart = null;
        let chartType = 'line';
        let priceData = [];
        
        // Chart functionality
        function initPriceChart() {
            console.log('Initializing price chart...');
            const ctx = document.getElementById('priceChart');
            if (!ctx) {
                console.log('Chart canvas not found');
                return;
            }
            
            // Generate sample data for demo
            const now = new Date();
            priceData = [];
            for (let i = 30; i >= 0; i--) {
                const date = new Date(now.getTime() - i * 24 * 60 * 60 * 1000);
                const basePrice = 5.84;
                const price = basePrice + (Math.random() - 0.5) * 0.5;
                priceData.push({
                    x: date,
                    y: price
                });
            }
            
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'COMEX Copper Price',
                        data: priceData,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 3,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Real-Time Copper Price Movement',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                displayFormats: {
                                    day: 'MMM dd'
                                }
                            },
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Price ($)'
                            },
                            beginAtZero: false
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
            
            console.log('âœ… Price chart initialized successfully');
        }
        
        function toggleChartType() {
            console.log('toggleChartType called');
            if (!priceChart) {
                console.error('Chart not initialized');
                alert('Chart not initialized yet. Please wait.');
                return;
            }
            
            chartType = chartType === 'line' ? 'bar' : 'line';
            console.log('Switching to:', chartType);
            
            if (chartType === 'line') {
                priceChart.config.type = 'line';
                priceChart.data.datasets[0] = {
                    label: 'COMEX Copper Price',
                    data: priceData,
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    tension: 0.4,
                    fill: true,
                    pointRadius: 3,
                    pointHoverRadius: 6
                };
            } else {
                priceChart.config.type = 'bar';
                priceChart.data.datasets[0] = {
                    label: 'COMEX Copper Price',
                    data: priceData,
                    backgroundColor: priceData.map(d => d.y > 5.84 ? 'rgba(56, 161, 105, 0.8)' : 'rgba(229, 62, 62, 0.8)'),
                    borderColor: priceData.map(d => d.y > 5.84 ? 'rgb(56, 161, 105)' : 'rgb(229, 62, 62)'),
                    borderWidth: 1
                };
            }
            
            priceChart.update();
            console.log('âœ… Chart type toggled to:', chartType);
        }
        
        function addTechnicalIndicator() {
            console.log('addTechnicalIndicator called');
            if (!priceChart) {
                console.error('Chart not initialized');
                alert('Chart not initialized yet. Please wait.');
                return;
            }
            
            // Check if SMA already exists
            const existingSMA = priceChart.data.datasets.find(dataset => dataset.label === 'SMA (5)');
            if (existingSMA) {
                // Remove existing SMA
                priceChart.data.datasets = priceChart.data.datasets.filter(dataset => dataset.label !== 'SMA (5)');
                console.log('âœ… Removed SMA indicator');
            } else {
                // Calculate simple moving average
                const smaData = [];
                const period = 5;
                
                for (let i = period - 1; i < priceData.length; i++) {
                    const sum = priceData.slice(i - period + 1, i + 1).reduce((acc, d) => acc + d.y, 0);
                    smaData.push({
                        x: priceData[i].x,
                        y: sum / period
                    });
                }
                
                // Add SMA line to chart
                priceChart.data.datasets.push({
                    label: 'SMA (5)',
                    data: smaData,
                    borderColor: '#f6ad55',
                    backgroundColor: 'rgba(246, 173, 85, 0.1)',
                    tension: 0.4,
                    fill: false,
                    type: 'line',
                    pointRadius: 2,
                    pointHoverRadius: 4
                });
                console.log('âœ… Added SMA indicator');
            }
            
            priceChart.update();
        }
        
        function exportChart() {
            console.log('exportChart called');
            if (!priceChart) {
                console.error('Chart not initialized');
                alert('Chart not initialized yet. Please wait.');
                return;
            }
            
            try {
                const url = priceChart.toBase64Image();
                const link = document.createElement('a');
                link.download = 'copperflow-price-chart.png';
                link.href = url;
                link.click();
                console.log('âœ… Chart exported successfully');
            } catch (error) {
                console.error('Error exporting chart:', error);
                alert('Error exporting chart. Please try again.');
            }
        }
        
        // Tab functionality
        function initTabs() {
            console.log('Initializing tabs...');
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            console.log(`Found ${tabs.length} tabs and ${tabContents.length} content sections`);
            
            // Remove existing event listeners by cloning
            tabs.forEach((tab, index) => {
                const newTab = tab.cloneNode(true);
                tab.parentNode.replaceChild(newTab, tab);
            });
            
            // Get fresh tabs after cloning
            const freshTabs = document.querySelectorAll('.tab');
            
            // Add click handlers
            freshTabs.forEach((tab, index) => {
                tab.addEventListener('click', function(e) {
                    console.log(`Tab clicked: ${this.textContent} -> ${this.getAttribute('data-target')}`);
                    
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const targetId = this.getAttribute('data-target');
                    if (!targetId) {
                        console.error('No data-target found');
                        return;
                    }
                    
                    // Remove active from all tabs
                    freshTabs.forEach(t => t.classList.remove('active'));
                    
                    // Add active to clicked tab
                    this.classList.add('active');
                    
                    // Hide all content
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        content.style.display = 'none';
                    });
                    
                    // Show target content
                    const targetContent = document.getElementById(targetId);
                    if (targetContent) {
                        targetContent.classList.add('active');
                        targetContent.style.display = 'block';
                        console.log(`âœ… Activated: ${targetId}`);
                    } else {
                        console.error(`âŒ Content not found: ${targetId}`);
                    }
                });
                
                console.log(`âœ… Added listener to tab ${index}: ${tab.textContent}`);
            });
            
            // Ensure first tab is active
            if (freshTabs.length > 0) {
                const firstTab = freshTabs[0];
                const firstTarget = firstTab.getAttribute('data-target');
                const firstContent = document.getElementById(firstTarget);
                
                freshTabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => {
                    c.classList.remove('active');
                    c.style.display = 'none';
                });
                
                firstTab.classList.add('active');
                if (firstContent) {
                    firstContent.classList.add('active');
                    firstContent.style.display = 'block';
                    console.log(`âœ… Set default tab: ${firstTarget}`);
                }
            }
            
            console.log('âœ… Tab initialization complete!');
        }
        
        // Performance Metrics Functions
        let accuracyChart = null;
        let throughputChart = null;
        
        function initPerformanceMetrics() {
            console.log('Initializing performance metrics...');
            loadPerformanceMetrics();
            initPerformanceCharts();
            
            // Update metrics every 30 seconds
            setInterval(loadPerformanceMetrics, 30000);
            setInterval(updatePerformanceCharts, 30000);
        }
        
        function loadPerformanceMetrics() {
            fetch('/api/performance-metrics')
                .then(response => response.json())
                .then(data => {
                    console.log('Performance metrics loaded:', data);
                    updatePerformanceDisplay(data);
                })
                .catch(error => {
                    console.error('âŒ Error loading performance metrics:', error);
                });
        }
        
        function updatePerformanceDisplay(data) {
            const metrics = data.summary_metrics;
            
            // Disabled metric updates - let template show dynamic values
            console.log('Performance display update disabled - using template values');
            /*
            // Update metric displays
            const accuracyEl = document.getElementById('accuracy-metric');
            const precisionEl = document.getElementById('precision-metric');
            const throughputEl = document.getElementById('throughput-metric');
            const connectionsEl = document.getElementById('connections-metric');
            const latencyEl = document.getElementById('latency-metric');
            const uptimeEl = document.getElementById('uptime-metric');
            
            if (accuracyEl) accuracyEl.textContent = metrics.accuracy;
            if (precisionEl) precisionEl.textContent = metrics.precision;
            if (throughputEl) throughputEl.textContent = metrics.processing_speed.split(' ')[0];
            if (connectionsEl) connectionsEl.textContent = metrics.concurrent_connections;
            if (latencyEl) latencyEl.textContent = metrics.average_latency;
            if (uptimeEl) uptimeEl.textContent = metrics.uptime;
            */
            
            // Update resume highlights if available
            if (data.resume_highlights) {
                updateResumeHighlights(data.resume_highlights);
            }
        }
        
        function updateResumeHighlights(highlights) {
            const container = document.getElementById('resume-highlights');
            if (!container) return;
            
            const gradients = [
                'linear-gradient(90deg, #e3f2fd 0%, #f3e5f5 100%)',
                'linear-gradient(90deg, #e8f5e8 0%, #f0f4ff 100%)',
                'linear-gradient(90deg, #fff3e0 0%, #fce4ec 100%)',
                'linear-gradient(90deg, #f3e5f5 0%, #e1f5fe 100%)',
                'linear-gradient(90deg, #e0f2f1 0%, #fff8e1 100%)',
                'linear-gradient(90deg, #ffebee 0%, #e8eaf6 100%)'
            ];
            
            const colors = ['#2196f3', '#4caf50', '#ff9800', '#9c27b0', '#009688', '#f44336'];
            
            container.innerHTML = highlights.map((highlight, index) => `
                <div style="padding: 15px; background: ${gradients[index % gradients.length]}; border-left: 4px solid ${colors[index % colors.length]}; border-radius: 8px;">
                    <strong>â€¢ ${highlight}</strong>
                </div>
            `).join('');
        }
        
        function initPerformanceCharts() {
            fetch('/api/performance-charts')
                .then(response => response.json())
                .then(data => {
                    console.log('Performance charts data loaded:', data);
                    createAccuracyChart(data.accuracy_chart);
                    createThroughputChart(data.throughput_chart);
                })
                .catch(error => {
                    console.error('âŒ Error loading performance charts:', error);
                });
        }
        
        function createAccuracyChart(data) {
            const ctx = document.getElementById('accuracyChart');
            if (!ctx) return;
            
            if (accuracyChart) {
                accuracyChart.destroy();
            }
            
            accuracyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Accuracy %',
                        data: data.data,
                        borderColor: '#4caf50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 70,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        function createThroughputChart(data) {
            const ctx = document.getElementById('throughputChart');
            if (!ctx) return;
            
            if (throughputChart) {
                throughputChart.destroy();
            }
            
            throughputChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Throughput (K pts/sec)',
                        data: data.data,
                        borderColor: '#2196f3',
                        backgroundColor: 'rgba(33, 150, 243, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return value + 'K';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        function updatePerformanceCharts() {
            fetch('/api/performance-charts')
                .then(response => response.json())
                .then(data => {
                    if (accuracyChart && data.accuracy_chart) {
                        accuracyChart.data.labels = data.accuracy_chart.labels;
                        accuracyChart.data.datasets[0].data = data.accuracy_chart.data;
                        accuracyChart.update();
                    }
                    
                    if (throughputChart && data.throughput_chart) {
                        throughputChart.data.labels = data.throughput_chart.labels;
                        throughputChart.data.datasets[0].data = data.throughput_chart.data;
                        throughputChart.update();
                    }
                })
                .catch(error => {
                    console.error('âŒ Error updating performance charts:', error);
                });
        }
        
        // Initialize everything when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing dashboard...');
            setTimeout(() => {
                initTabs();
                initPriceChart();
                initPerformanceMetrics(); // Initialize performance metrics
                startPipelineMonitoring(); // Start ML pipeline monitoring
            }, 100);
        });
        
        // Make functions globally available
        window.toggleChartType = toggleChartType;
        window.addTechnicalIndicator = addTechnicalIndicator;
        window.exportChart = exportChart;
        
        // Monte Carlo Simulation Functions
        async function runMonteCarloSimulation() {
            const currentPrice = parseFloat(document.getElementById('mc-current-price').value);
            const days = parseInt(document.getElementById('mc-days').value);
            const nSimulations = parseInt(document.getElementById('mc-simulations').value);
            
            // Show loading
            document.getElementById('mc-loading').style.display = 'block';
            document.getElementById('mc-results').style.display = 'none';
            
            try {
                const response = await fetch('/api/monte_carlo', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        current_price: currentPrice,
                        days: days,
                        n_simulations: nSimulations
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayMonteCarloResults(data.results, data.summary);
                } else {
                    alert('Error running simulation: ' + data.error);
                }
                
            } catch (error) {
                console.error('Error running Monte Carlo simulation:', error);
                alert('Error running simulation. Please try again.');
            } finally {
                document.getElementById('mc-loading').style.display = 'none';
            }
        }
        
        function displayMonteCarloResults(results, summary) {
            const stats = results.statistics;
            
            // Update key metrics
            document.getElementById('mc-expected-price').textContent = `$${stats.mean_final_price.toFixed(2)}`;
            document.getElementById('mc-profit-prob').textContent = `${(stats.probability_profit * 100).toFixed(1)}%`;
            document.getElementById('mc-var').textContent = `${(stats.var_95 * 100).toFixed(1)}%`;
            document.getElementById('mc-risk-level').textContent = summary.risk_assessment;
            
            // Update recommendation
            document.getElementById('mc-recommendation').textContent = summary.recommendation;
            
            // Show results
            document.getElementById('mc-results').style.display = 'block';
            
            console.log('Monte Carlo results displayed successfully');
        }
        
        // Make Monte Carlo function globally available
        window.runMonteCarloSimulation = runMonteCarloSimulation;
        
        // ML Pipeline Functions
        async function refreshPipelineStatus() {
            console.log('Refreshing ML Pipeline status...');
            try {
                const response = await fetch('/api/ml_pipeline/status');
                const data = await response.json();
                
                if (data.success) {
                    updatePipelineUI(data.status);
                    console.log('âœ… Pipeline status refreshed');
                } else {
                    console.error('Failed to refresh pipeline status:', data.error);
                    alert('Failed to refresh pipeline status');
                }
            } catch (error) {
                console.error('Error refreshing pipeline status:', error);
                alert('Error refreshing pipeline status');
            }
        }
        
        async function triggerManualRetrain() {
            console.log('Triggering manual model retraining...');
            
            // Show loading state
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'Retraining...';
            button.disabled = true;
            
            try {
                const response = await fetch('/api/ml_pipeline/retrain', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(`Model retraining completed! New version: v${data.new_version}`);
                    refreshPipelineStatus(); // Refresh status after retraining
                    console.log('âœ… Model retraining completed');
                } else {
                    alert('Model retraining failed: ' + data.message);
                    console.error('Model retraining failed:', data.message);
                }
            } catch (error) {
                console.error('Error triggering retraining:', error);
                alert('Error triggering retraining');
            } finally {
                // Restore button state
                button.textContent = originalText;
                button.disabled = false;
            }
        }
        
        async function makePrediction() {
            console.log('Making ML prediction...');
            try {
                const response = await fetch('/api/ml_pipeline/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const prediction = data.prediction;
                    const driftDetected = data.drift_detected;
                    const performanceDegraded = data.performance_degraded;
                    
                    let message = `ML Prediction: $${prediction.toFixed(4)}\\n`;
                    message += `Model Version: v${data.model_version}\\n`;
                    
                    if (driftDetected) {
                        message += 'ðŸš¨ Concept drift detected!\\n';
                    }
                    
                    if (performanceDegraded) {
                        message += 'ðŸ“‰ Performance degradation detected!\\n';
                    }
                    
                    alert(message);
                    console.log('âœ… ML prediction completed:', prediction);
                } else {
                    alert('Prediction failed: ' + data.error);
                    console.error('Prediction failed:', data.error);
                }
            } catch (error) {
                console.error('Error making prediction:', error);
                alert('Error making prediction');
            }
        }
        
        async function viewPerformanceHistory() {
            console.log('Fetching performance history...');
            try {
                const response = await fetch('/api/ml_pipeline/performance');
                const data = await response.json();
                
                if (data.success) {
                    const current = data.current_performance;
                    const history = data.performance_history;
                    
                    let message = 'ML Pipeline Performance:\\n\\n';
                    message += `Current Accuracy: ${(current.accuracy * 100).toFixed(1)}%\\n`;
                    message += `Current MSE: ${current.mse.toFixed(4)}\\n`;
                    message += `Current MAE: ${current.mae.toFixed(4)}\\n`;
                    message += `Sample Size: ${current.sample_size}\\n\\n`;
                    
                    message += `Performance History (Last ${history.length} records):\\n`;
                    history.slice(-5).forEach((record, index) => {
                        message += `${index + 1}. Accuracy: ${(record.accuracy * 100).toFixed(1)}% | MSE: ${record.mse.toFixed(4)}\\n`;
                    });
                    
                    alert(message);
                    console.log('âœ… Performance history retrieved');
                } else {
                    alert('Failed to get performance history: ' + data.error);
                    console.error('Failed to get performance history:', data.error);
                }
            } catch (error) {
                console.error('Error fetching performance history:', error);
                alert('Error fetching performance history');
            }
        }
        
        function updatePipelineUI(status) {
            // Update current copper price - keep this as it's dynamic
            fetch('/api/price-history')
                .then(response => response.json())
                .then(data => {
                    const priceElement = document.getElementById('ml-current-price');
                    if (priceElement && data.current_price) {
                        priceElement.textContent = `$${data.current_price.toFixed(2)}`;
                    }
                })
                .catch(error => console.error('Error fetching price:', error));
            
            // Comment out static overrides - let template values show instead
            /*
            const versionElement = document.getElementById('ml-model-version');
            if (versionElement) {
                versionElement.textContent = `v${status.current_model_version}`;
            }
            
            const samplesElement = document.getElementById('ml-samples');
            if (samplesElement) {
                samplesElement.textContent = status.training_data_size.toLocaleString();
            }
            
            const accuracyElement = document.getElementById('ml-accuracy');
            if (accuracyElement && status.model_accuracy) {
                accuracyElement.textContent = `${(status.model_accuracy * 100).toFixed(1)}%`;
            }
            
            const currentPerf = status.performance_monitor_status.current_performance;
            if (currentPerf) {
                const mseElement = document.getElementById('ml-mse');
                if (mseElement) {
                    mseElement.textContent = currentPerf.mse.toFixed(4);
                }
                
                const maeElement = document.getElementById('ml-mae');
                if (maeElement) {
                    maeElement.textContent = currentPerf.mae.toFixed(4);
                }
                
                const rmseElement = document.getElementById('ml-rmse');
                if (rmseElement) {
                    rmseElement.textContent = currentPerf.rmse.toFixed(4);
                }
            }
            
            const driftElement = document.getElementById('ml-drift-status');
            if (driftElement && status.drift_detector_status) {
                const driftStatus = status.drift_detector_status;
                if (driftStatus.current_data_size > driftStatus.reference_data_size * 0.8) {
                    driftElement.textContent = 'Monitoring';
                    driftElement.parentElement.style.background = 'var(--gradient-warning)';
                } else {
                    driftElement.textContent = driftStatus.drift_status || 'Normal';
                    driftElement.parentElement.style.background = 'var(--gradient-info)';
                }
            }
            
            const retrainElement = document.getElementById('ml-last-retrain');
            if (retrainElement && status.last_retrain_time) {
                const retrainTime = new Date(status.last_retrain_time);
                const now = new Date();
                const diffHours = Math.floor((now - retrainTime) / (1000 * 60 * 60));
                retrainElement.textContent = `${diffHours}h ago`;
            }
            */
        }
        
        // Auto-refresh pipeline status every 30 seconds - DISABLED to show template values
        function startPipelineMonitoring() {
            // Disabled auto-refresh to let template show dynamic values
            console.log('Pipeline monitoring disabled - using template dynamic values');
            /*
            // Initial load
            setTimeout(refreshPipelineStatus, 2000);
            
            // Auto-refresh every 30 seconds
            setInterval(refreshPipelineStatus, 30000);
            */
        }
        
        // Make ML Pipeline functions globally available
        window.refreshPipelineStatus = refreshPipelineStatus;
        window.triggerManualRetrain = triggerManualRetrain;
        window.makePrediction = makePrediction;
        window.viewPerformanceHistory = viewPerformanceHistory;
    </script>
</body>
</html>
